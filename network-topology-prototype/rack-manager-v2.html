<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infrastructure Management v4 - Data-Driven Rack Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            overflow-x: auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 80px);
            gap: 1rem;
            padding: 1rem;
            min-height: 800px;
        }

        /* Rack List Panel */
        .rack-list-panel {
            width: 350px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .rack-list-panel h3 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .rack-search {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .rack-search:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .rack-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .rack-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rack-item:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .rack-item.active {
            background: #bee3f8;
            border-color: #4299e1;
            color: #2b6cb0;
        }

        .rack-info {
            flex: 1;
        }

        .rack-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .rack-id {
            font-size: 0.75rem;
            color: #718096;
        }

        .rack-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
        }

        .status-dot.unknown {
            background: #a0aec0;
        }

        .status-text {
            font-size: 0.75rem;
            color: #718096;
        }

        /* Toolbox Panel */
        .toolbox {
            width: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .toolbox h3 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .tool-category {
            margin-bottom: 2rem;
        }

        .tool-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
        }

        .tool-item:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tool-item:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .tool-icon {
            width: 32px;
            height: 32px;
            margin-right: 0.75rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
        }

        .tool-info {
            flex: 1;
        }

        .tool-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .tool-desc {
            font-size: 0.75rem;
            color: #718096;
            margin-top: 0.2rem;
        }

        /* Device Colors */
        .switch { background: #4299e1; }
        .patch-panel { background: #48bb78; }
        .server { background: #ed8936; }
        .ups { background: #9f7aea; }
        .pdu { background: #38b2ac; }

        /* Rack View */
        .rack-container {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            overflow: auto;
            position: relative;
        }

        .rack-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .rack-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
        }

        .rack-details {
            color: #718096;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .rack-controls {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        /* Rack Visual */
        .rack-visual {
            display: flex;
            gap: 2rem;
            justify-content: center;
            position: relative;
            min-height: 600px;
            width: 100%;
        }

        .rack {
            background: #2d3748;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
            position: relative;
            width: 100%;
            max-width: 800px;
        }

        .rack-frame {
            background: #4a5568;
            border-radius: 8px;
            padding: 1rem;
            min-height: 600px;
            width: 100%;
            position: relative;
        }

        .rack-units {
            display: flex;
            flex-direction: column-reverse;
            height: 100%;
            gap: 2px;
        }

        .rack-unit {
            height: 32px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            position: relative;
            transition: all 0.2s ease;
            margin-bottom: 2px;
        }

        .rack-unit:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .rack-unit.occupied {
            background: #bee3f8;
            border-color: #4299e1;
            height: 36px;
        }

        .rack-unit.drop-zone {
            background: #c6f6d5;
            border-color: #48bb78;
            border-style: dashed;
            border-width: 2px;
        }

        .unit-number {
            position: absolute;
            left: -50px;
            font-size: 0.75rem;
            color: #a0aec0;
            font-weight: 600;
            width: 40px;
            text-align: right;
        }

        .device-in-rack {
            width: 100%;
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            color: white;
            font-weight: 500;
            font-size: 0.8rem;
            cursor: pointer;
            position: relative;
            justify-content: space-between;
        }

        .device-ports {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            max-width: 300px;
            align-items: center;
        }

        .port {
            width: 14px;
            height: 14px;
            background: #718096;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: white;
            font-weight: bold;
        }

        .port:hover {
            background: #4299e1;
            transform: scale(1.3);
            z-index: 10;
        }

        .port.connected {
            background: #48bb78;
            box-shadow: 0 0 8px rgba(72, 187, 120, 0.6);
        }

        .port.selected {
            background: #ed8936;
            transform: scale(1.4);
            box-shadow: 0 0 12px rgba(237, 137, 54, 0.8);
            z-index: 10;
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #718096;
            font-style: italic;
        }

        .error {
            color: #e53e3e;
            background: #fed7d7;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-container {
                flex-direction: column;
                height: auto;
            }
            
            .rack-list-panel, .toolbox {
                width: 100%;
                max-height: 200px;
            }
            
            .rack-visual {
                flex-direction: column;
                align-items: center;
            }
            
            .rack {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèóÔ∏è Infrastructure Management v4 - Data-Driven Rack Manager</h1>
        <p>Select a rack from the list to view and manage its configuration</p>
        <div style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.9;">
            <strong>Data Source:</strong> network/data/listofracks.txt ‚Ä¢ 
            <strong>Total Racks:</strong> <span id="totalRacksCount">Loading...</span>
        </div>
    </div>

    <div class="main-container">
        <!-- Rack List Panel -->
        <div class="rack-list-panel">
            <h3>üìã Rack Inventory</h3>
            
            <input type="text" class="rack-search" id="rackSearch" placeholder="Search racks by ID or name...">
            
            <div class="rack-list" id="rackList">
                <div class="loading">Loading rack data...</div>
            </div>
        </div>

        <!-- Toolbox Panel -->
        <div class="toolbox">
            <h3>üß∞ Device Toolbox</h3>
            
            <div class="tool-category">
                <h4 style="color: #718096; font-size: 0.9rem; margin-bottom: 0.75rem;">Network Devices</h4>
                
                <div class="tool-item" draggable="true" data-type="device" data-device-type="switch" data-ports="24">
                    <div class="tool-icon switch">SW</div>
                    <div class="tool-info">
                        <div class="tool-name">24-Port Switch</div>
                        <div class="tool-desc">Gigabit Ethernet Switch</div>
                    </div>
                </div>

                <div class="tool-item" draggable="true" data-type="device" data-device-type="switch" data-ports="48">
                    <div class="tool-icon switch">SW</div>
                    <div class="tool-info">
                        <div class="tool-name">48-Port Switch</div>
                        <div class="tool-desc">Gigabit Ethernet Switch</div>
                    </div>
                </div>

                <div class="tool-item" draggable="true" data-type="device" data-device-type="patch-panel" data-ports="24">
                    <div class="tool-icon patch-panel">PP</div>
                    <div class="tool-info">
                        <div class="tool-name">24-Port Patch Panel</div>
                        <div class="tool-desc">Cat6 RJ45 Patch Panel</div>
                    </div>
                </div>

                <div class="tool-item" draggable="true" data-type="device" data-device-type="server" data-ports="4">
                    <div class="tool-icon server">SV</div>
                    <div class="tool-info">
                        <div class="tool-name">1U Server</div>
                        <div class="tool-desc">Rack Mount Server</div>
                    </div>
                </div>
            </div>

            <div class="tool-category">
                <h4 style="color: #718096; font-size: 0.9rem; margin-bottom: 0.75rem;">Power Infrastructure</h4>
                
                <div class="tool-item" draggable="true" data-type="device" data-device-type="ups" data-ports="0">
                    <div class="tool-icon ups">UPS</div>
                    <div class="tool-info">
                        <div class="tool-name">UPS Unit</div>
                        <div class="tool-desc">Uninterruptible Power Supply</div>
                    </div>
                </div>

                <div class="tool-item" draggable="true" data-type="device" data-device-type="pdu" data-ports="8">
                    <div class="tool-icon pdu">PDU</div>
                    <div class="tool-info">
                        <div class="tool-name">8-Outlet PDU</div>
                        <div class="tool-desc">Power Distribution Unit</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rack View -->
        <div class="rack-container">
            <div class="rack-header">
                <div class="rack-info">
                    <div class="rack-title" id="rackTitle">Select a rack to view details</div>
                    <div class="rack-details" id="rackDetails">Choose a rack from the list to start managing devices</div>
                </div>
                <div class="rack-controls">
                    <button class="btn btn-secondary" onclick="clearRack()" disabled id="clearBtn">Clear Rack</button>
                    <button class="btn btn-primary" onclick="saveConfiguration()" disabled id="saveBtn">Save Config</button>
                </div>
            </div>

            <div class="rack-visual" id="rackVisual">
                <div style="display: flex; align-items: center; justify-content: center; height: 400px; color: #718096; font-style: italic;">
                    Select a rack from the list to begin configuration
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let rackData = {};
        let selectedPorts = [];
        let deviceCounter = 1;
        let currentRackId = null;
        let rackInventory = [];
        let filteredRacks = [];

        // Initialize the application
        async function initializeApp() {
            try {
                await loadRackInventory();
                setupEventListeners();
                setupDragAndDrop();
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showError('Failed to load rack data. Please check the data file.');
            }
        }

        // Load rack inventory from data file
        async function loadRackInventory() {
            try {
                const response = await fetch('network/data/listofracks.txt');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                parseRackData(text);
                displayRackList();
                updateTotalCount();
            } catch (error) {
                console.error('Error loading rack inventory:', error);
                throw error;
            }
        }

        // Parse the rack data from text file
        function parseRackData(text) {
            const lines = text.split('\n');
            rackInventory = [];
            
            // Skip header line and process data
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const parts = line.split('\t');
                if (parts.length >= 2) {
                    const id = parts[0].trim();
                    const name = parts[1].trim();
                    
                    if (id && name) {
                        rackInventory.push({
                            id: id,
                            name: name,
                            fullName: `Rack ${name} (ID: ${id})`,
                            status: 'unknown', // We don't have status data in the file
                            location: 'Unknown', // We don't have location data in the file
                            devices: {},
                            connections: []
                        });
                    }
                }
            }
            
            filteredRacks = [...rackInventory];
            console.log(`Loaded ${rackInventory.length} racks from data file`);
        }

        // Display the rack list in the UI
        function displayRackList() {
            const rackListContainer = document.getElementById('rackList');
            
            if (filteredRacks.length === 0) {
                rackListContainer.innerHTML = '<div class="loading">No racks found</div>';
                return;
            }
            
            rackListContainer.innerHTML = '';
            
            filteredRacks.forEach(rack => {
                const rackItem = document.createElement('div');
                rackItem.className = 'rack-item';
                rackItem.dataset.rackId = rack.id;
                rackItem.onclick = () => selectRack(rack.id);
                
                rackItem.innerHTML = `
                    <div class="rack-info">
                        <div class="rack-name">${rack.name}</div>
                        <div class="rack-id">ID: ${rack.id}</div>
                    </div>
                    <div class="rack-status">
                        <div class="status-dot ${rack.status}"></div>
                        <div class="status-text">${rack.status}</div>
                    </div>
                `;
                
                rackListContainer.appendChild(rackItem);
            });
        }

        // Update total rack count
        function updateTotalCount() {
            document.getElementById('totalRacksCount').textContent = rackInventory.length;
        }

        // Setup event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('rackSearch');
            searchInput.addEventListener('input', handleSearch);
        }

        // Handle search functionality
        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            
            if (!searchTerm) {
                filteredRacks = [...rackInventory];
            } else {
                filteredRacks = rackInventory.filter(rack => 
                    rack.id.toLowerCase().includes(searchTerm) ||
                    rack.name.toLowerCase().includes(searchTerm)
                );
            }
            
            displayRackList();
        }

        // Select a rack
        function selectRack(rackId) {
            // Update UI to show selected rack
            document.querySelectorAll('.rack-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const selectedItem = document.querySelector(`[data-rack-id="${rackId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }
            
            // Find rack data
            const rack = rackInventory.find(r => r.id === rackId);
            if (!rack) return;
            
            currentRackId = rackId;
            
            // Update rack header
            document.getElementById('rackTitle').textContent = rack.fullName;
            document.getElementById('rackDetails').textContent = `Location: ${rack.location} ‚Ä¢ Status: ${rack.status} ‚Ä¢ 42U Standard Rack`;
            
            // Enable controls
            document.getElementById('clearBtn').disabled = false;
            document.getElementById('saveBtn').disabled = false;
            
            // Load rack configuration
            loadRackConfiguration(rack);
        }

        // Load rack configuration
        function loadRackConfiguration(rack) {
            // Clear current rack
            rackData = { ...rack.devices };
            
            // Build rack display
            buildRackDisplay();
            
            console.log(`Loaded rack ${rack.id}: ${rack.name}`);
        }

        // Build rack display (simplified version for now)
        function buildRackDisplay() {
            const rackVisual = document.getElementById('rackVisual');
            
            rackVisual.innerHTML = `
                <div class="rack">
                    <div class="rack-frame">
                        <div class="rack-units" id="rackUnits">
                            <!-- Rack units will be generated here -->
                        </div>
                    </div>
                </div>
            `;
            
            const rackUnits = document.getElementById('rackUnits');
            
            // Create 42 rack units (simplified for now)
            for (let i = 42; i >= 1; i--) {
                const unit = document.createElement('div');
                unit.className = 'rack-unit';
                unit.dataset.unit = i;
                
                const unitNumber = document.createElement('div');
                unitNumber.className = 'unit-number';
                unitNumber.textContent = i;
                unit.appendChild(unitNumber);
                
                // Add drop zone functionality
                unit.addEventListener('dragover', handleDragOver);
                unit.addEventListener('drop', handleDrop);
                unit.addEventListener('dragleave', handleDragLeave);
                
                rackUnits.appendChild(unit);
            }
        }

        // Drag and drop functionality
        function setupDragAndDrop() {
            const toolItems = document.querySelectorAll('.tool-item');
            
            toolItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', '');
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drop-zone');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drop-zone');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drop-zone');
            
            const draggedElement = document.querySelector('.dragging');
            if (!draggedElement) return;
            
            const unitNumber = parseInt(e.currentTarget.dataset.unit);
            const deviceType = draggedElement.dataset.deviceType;
            const devicePorts = parseInt(draggedElement.dataset.ports) || 0;
            
            // Check if unit is already occupied
            if (e.currentTarget.classList.contains('occupied')) {
                alert('This rack unit is already occupied!');
                return;
            }
            
            // Add device to rack
            addDeviceToRack(unitNumber, deviceType, devicePorts);
        }

        function addDeviceToRack(unitNumber, deviceType, portCount) {
            const unit = document.querySelector(`[data-unit="${unitNumber}"]`);
            if (!unit) return;
            
            const deviceId = `${deviceType}-${deviceCounter++}`;
            
            // Store in rack data
            rackData[unitNumber] = {
                deviceId,
                deviceType,
                portCount,
                ports: {},
                name: `${deviceType.toUpperCase().replace('-', ' ')} ${deviceId}`
            };
            
            // Create device element
            const device = document.createElement('div');
            device.className = `device-in-rack ${deviceType}`;
            device.dataset.deviceId = deviceId;
            device.dataset.deviceType = deviceType;
            device.innerHTML = `
                <span title="${rackData[unitNumber].name}">${rackData[unitNumber].name}</span>
                <div class="device-ports" id="ports-${deviceId}"></div>
            `;
            
            // Add ports
            const portsContainer = device.querySelector('.device-ports');
            for (let i = 1; i <= portCount; i++) {
                const port = document.createElement('div');
                port.className = 'port';
                port.dataset.portId = `${deviceId}-port-${i}`;
                port.dataset.deviceId = deviceId;
                port.dataset.portNumber = i;
                port.dataset.unitNumber = unitNumber;
                port.title = `${rackData[unitNumber].name} - Port ${i}`;
                port.textContent = i;
                portsContainer.appendChild(port);
            }
            
            // Add to rack unit
            unit.appendChild(device);
            unit.classList.add('occupied');
            
            console.log(`Added ${deviceType} to unit ${unitNumber} in rack ${currentRackId}`);
        }

        // Clear rack
        function clearRack() {
            if (!currentRackId) return;
            
            if (confirm('Are you sure you want to clear all devices from this rack?')) {
                rackData = {};
                buildRackDisplay();
                console.log(`Cleared rack ${currentRackId}`);
            }
        }

        // Save configuration
        function saveConfiguration() {
            if (!currentRackId) return;
            
            const rack = rackInventory.find(r => r.id === currentRackId);
            if (rack) {
                rack.devices = { ...rackData };
                console.log(`Saved configuration for rack ${currentRackId}:`, rack.devices);
                alert(`Configuration saved for rack ${rack.name} (ID: ${currentRackId})`);
            }
        }

        // Show error message
        function showError(message) {
            const rackList = document.getElementById('rackList');
            rackList.innerHTML = `<div class="error">${message}</div>`;
        }

        // Initialize the application when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>