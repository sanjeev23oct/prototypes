<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Room Rack Manager - Detailed View</title>
    <link rel="stylesheet" href="css/rack-manager-v3.css">
    <style>
        /* Navigation breadcrumb styles */
        .navigation-breadcrumb {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 0.75rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .back-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(-2px);
        }
        
        .breadcrumb-separator {
            color: rgba(255,255,255,0.6);
            font-size: 1.2rem;
        }
        
        .current-location {
            font-weight: 600;
            color: #90cdf4;
        }
        
        .rack-context {
            margin-left: auto;
            font-size: 0.8rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè¢ Server Room Network Rack - Core Infrastructure</h1>
        <p>Main data center server room with core switches, servers, and distribution LIU</p>
        <div style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.9;">
            <strong>Location:</strong> Main Data Center ‚Ä¢ 
            <strong>Core Switch:</strong> Cisco Catalyst 9300 ‚Ä¢ 
            <strong>LIU:</strong> 24-Port Fiber Distribution Hub ‚Ä¢
            <strong>Servers:</strong> 5 Active Production Servers
        </div>
    </div>

    <!-- Navigation Breadcrumb -->
    <div class="navigation-breadcrumb">
        <button class="back-button" onclick="navigateBack()">
            ‚Üê Back to Topology
        </button>
        <span class="breadcrumb-separator">‚Ä¢</span>
        <span>Network Topology</span>
        <span class="breadcrumb-separator">‚Üí</span>
        <span class="current-location">Server Room - Main Data Center</span>
        <div class="rack-context">
            Core Infrastructure ‚Ä¢ Distribution Hub
        </div>
    </div>

    <div class="main-container">
        <!-- Toolbox Panel -->
        <div class="toolbox" id="toolbox">
            <div class="toolbox-header">
                <h3 style="margin: 0;">üß∞ Server Room Equipment</h3>
                <button class="toolbox-toggle" onclick="toggleToolbox()">
                    <span id="toolboxToggleIcon">‚óÄ</span>
                </button>
            </div>
            
            <div class="toolbox-content">
                <div class="tool-category">
                    <h4 style="color: #718096; font-size: 0.9rem; margin-bottom: 0.75rem;">Core Infrastructure</h4>
                    
                    <div class="tool-item" draggable="true" data-type="device" data-device-type="switch" data-ports="48">
                        <div class="tool-icon switch">SW</div>
                        <div class="tool-info">
                            <div class="tool-name">48-Port Core Switch</div>
                            <div class="tool-desc">Cisco Catalyst 9300</div>
                        </div>
                    </div>

                    <div class="tool-item" draggable="true" data-type="device" data-device-type="patch-panel" data-ports="24">
                        <div class="tool-icon patch-panel" style="background: #d69e2e;">LIU</div>
                        <div class="tool-info">
                            <div class="tool-name">24-Port LIU</div>
                            <div class="tool-desc">Fiber Distribution Hub</div>
                        </div>
                    </div>

                    <div class="tool-item" draggable="true" data-type="device" data-device-type="server" data-ports="4">
                        <div class="tool-icon server" style="background: #38b2ac;">SRV</div>
                        <div class="tool-info">
                            <div class="tool-name">Production Server</div>
                            <div class="tool-desc">Dell PowerEdge R740</div>
                        </div>
                    </div>

                    <div class="tool-item" draggable="true" data-type="device" data-device-type="server" data-ports="2">
                        <div class="tool-icon server" style="background: #805ad5;">DB</div>
                        <div class="tool-info">
                            <div class="tool-name">Database Server</div>
                            <div class="tool-desc">High-Performance DB</div>
                        </div>
                    </div>
                </div>

                <div class="tool-category">
                    <h4 style="color: #718096; font-size: 0.9rem; margin-bottom: 0.75rem;">Power & Infrastructure</h4>
                    
                    <div class="tool-item" draggable="true" data-type="device" data-device-type="ups" data-ports="0">
                        <div class="tool-icon ups">UPS</div>
                        <div class="tool-info">
                            <div class="tool-name">Enterprise UPS</div>
                            <div class="tool-desc">APC Smart-UPS 3000VA</div>
                        </div>
                    </div>

                    <div class="tool-item" draggable="true" data-type="device" data-device-type="pdu" data-ports="8">
                        <div class="tool-icon pdu" style="background: #e53e3e;">PDU</div>
                        <div class="tool-info">
                            <div class="tool-name">Rack PDU</div>
                            <div class="tool-desc">Managed Power Distribution</div>
                        </div>
                    </div>
                </div>

                <div class="tool-category">
                    <h4 style="color: #718096; font-size: 0.9rem; margin-bottom: 0.75rem;">Navigation</h4>
                    
                    <button class="tool-item" onclick="navigateBack()" style="cursor: pointer; border: 2px solid #4299e1;">
                        <div class="tool-icon" style="background: #4299e1;">üåê</div>
                        <div class="tool-info">
                            <div class="tool-name">Back to Topology</div>
                            <div class="tool-desc">Return to multi-rack view</div>
                        </div>
                    </button>
                    
                    <button class="tool-item" onclick="navigateToRack('G2C')" style="cursor: pointer; border: 2px solid #48bb78;">
                        <div class="tool-icon" style="background: #48bb78;">üö™</div>
                        <div class="tool-info">
                            <div class="tool-name">Gate 2C</div>
                            <div class="tool-desc">View Gate 2C rack</div>
                        </div>
                    </button>
                    
                    <button class="tool-item" onclick="navigateToRack('G2B')" style="cursor: pointer; border: 2px solid #ed8936;">
                        <div class="tool-icon" style="background: #ed8936;">üö™</div>
                        <div class="tool-info">
                            <div class="tool-name">Gate 2B</div>
                            <div class="tool-desc">View Gate 2B rack</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Rack View -->
        <div class="rack-container">
            <div class="rack-header">
                <div class="rack-info">
                    <div class="rack-title" id="rackTitle">Server Room Core Infrastructure - Main Data Center</div>
                    <div class="rack-details" id="rackDetails">Cisco Catalyst 9300 Core Switch ‚Ä¢ 24-Port Fiber Distribution LIU ‚Ä¢ Dell PowerEdge Servers ‚Ä¢ Redundant UPS Systems</div>
                </div>
                <div class="rack-controls">
                    <button class="btn btn-secondary" onclick="toggleConnectionMode()" id="connectionModeBtn">üîó Connection Mode</button>
                    <button class="btn btn-secondary" onclick="toggleCableVisibility()">Toggle Cables</button>
                    <button class="btn btn-secondary" onclick="clearRack()">Clear Rack</button>
                    <button class="btn btn-primary" onclick="saveConfiguration()">Save Config</button>
                </div>
            </div>

            <div class="rack-visual">
                <div class="rack">
                    <div class="rack-frame">
                        <div class="rack-units" id="rackUnits">
                            <!-- Rack units will be generated by JavaScript -->
                        </div>
                        <!-- Cable visualization container -->
                        <svg class="cables-container" id="cablesContainer">
                            <!-- Cables will be drawn here -->
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Connection Panel -->
        <div class="connection-panel">
            <h3>üîå Server Room Connections</h3>
            
            <!-- Port Usage Summary -->
            <div style="background: #f8fafc; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border-left: 4px solid #4299e1;">
                <h4 style="margin: 0 0 0.5rem 0; color: #2d3748; font-size: 0.9rem;">üìä Infrastructure Status</h4>
                <div id="portSummary" style="font-size: 0.8rem; color: #4a5568;">
                    <div>üè¢ Core Switch: <span style="color: #48bb78; font-weight: 600;">Online</span></div>
                    <div>üìä Server Load: 78% average</div>
                    <div>üîã UPS Status: Normal (95% capacity)</div>
                    <div>üå°Ô∏è Temperature: 22¬∞C (Normal)</div>
                </div>
            </div>
            
            <!-- Downlink Status -->
            <div style="background: #f0fff4; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border-left: 4px solid #48bb78;">
                <h4 style="margin: 0 0 0.5rem 0; color: #2d3748; font-size: 0.9rem;">üîó Downlink Distribution</h4>
                <div style="font-size: 0.8rem; color: #4a5568;">
                    <div>üö™ Gate 2C: <span style="color: #48bb78; font-weight: 600;">4 x 10G Active</span></div>
                    <div>üö™ Gate 2B: <span style="color: #48bb78; font-weight: 600;">4 x 1G Active</span></div>
                    <div>üìä Total Bandwidth: 44 Gbps distributed</div>
                    <div>üîÑ Load Balancing: Active</div>
                </div>
            </div>
            
            <div class="connection-form" id="connectionForm">
                <div class="form-group">
                    <label class="form-label">Connection Type</label>
                    <select class="form-select" id="connectionType">
                        <option value="ethernet">Ethernet</option>
                        <option value="fiber">Fiber Optic</option>
                        <option value="power">Power</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cable Length (meters)</label>
                    <input type="number" class="form-input" id="cableLength" value="1" min="0.1" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cable ID</label>
                    <input type="text" class="form-input" id="cableId" placeholder="Auto-generated">
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="createConnection()">Create Connection</button>
                    <button class="btn btn-secondary" onclick="cancelConnection()">Cancel</button>
                </div>
            </div>

            <div class="connections-list" id="connectionsList">
                <!-- Connections will be populated here -->
            </div>
        </div>
    </div>

    <!-- Enhanced Legend -->
    <button class="legend-toggle" onclick="toggleLegend()" id="legendToggle">
        üìã Show Legend
    </button>
    
    <div class="port-legend hidden" id="portLegend">
        <div class="legend-content">
            <div class="legend-section">
                <h4>üîå Port Status</h4>
                
                <div class="legend-item">
                    <div class="legend-port available">1</div>
                    <div class="legend-text">Available Port</div>
                </div>
                <div class="legend-description">Gray - Ready for connection</div>
                
                <div class="legend-item">
                    <div class="legend-port connected">2</div>
                    <div class="legend-text">Connected Port</div>
                </div>
                <div class="legend-description">Green - Active connection</div>
                
                <div class="legend-item">
                    <div class="legend-port uplink">3</div>
                    <div class="legend-text">Distribution Port</div>
                </div>
                <div class="legend-description">Purple - Distributes to remote sites</div>
                
                <div class="legend-item">
                    <div class="legend-port uplink-connected">4</div>
                    <div class="legend-text">Active Distribution</div>
                </div>
                <div class="legend-description">Blue - Active distribution link</div>
                
                <div class="legend-item">
                    <div class="legend-port selected">5</div>
                    <div class="legend-text">Selected Port</div>
                </div>
                <div class="legend-description">Orange - Ready to connect</div>
            </div>
            
            <div class="legend-section cable-legend">
                <h4>üîó Cable Types</h4>
                
                <div class="cable-legend-item">
                    <div class="legend-cable ethernet"></div>
                    <div class="legend-text">Ethernet (Cat6)</div>
                </div>
                <div class="legend-description">Blue solid - Network data</div>
                
                <div class="cable-legend-item">
                    <div class="legend-cable fiber"></div>
                    <div class="legend-text">Fiber Optic</div>
                </div>
                <div class="legend-description">Orange dashed - High-speed data</div>
                
                <div class="cable-legend-item">
                    <div class="legend-cable power"></div>
                    <div class="legend-text">Power Cable</div>
                </div>
                <div class="legend-description">Red thick - Power supply</div>
            </div>
        </div>
    </div>

    <script src="js/rack-manager-v3.js"></script>
    <script>
        // Navigation functions for seamless rack switching
        function navigateBack() {
            // Check if we came from topology view
            const topologyState = sessionStorage.getItem('topologyView');
            if (topologyState) {
                const state = JSON.parse(topologyState);
                window.location.href = state.returnUrl || 'network-topology-view.html';
            } else {
                // Fallback to topology view
                window.location.href = 'network-topology-view.html';
            }
        }
        
        function navigateToRack(rackId) {
            // Store current navigation context
            sessionStorage.setItem('topologyView', JSON.stringify({
                selectedRack: rackId,
                returnUrl: 'network-topology-view.html',
                timestamp: new Date().toISOString()
            }));
            
            // Navigate to specific rack
            const rackPages = {
                'G2C': 'rack-manager-g2c.html',
                'G2B': 'rack-manager-g2b.html',
                'SR': 'rack-manager-sr.html'
            };
            
            if (rackPages[rackId]) {
                window.location.href = rackPages[rackId];
            }
        }
        
        // Override switchRack function to work with Server Room
        function switchRack(rackId) {
            const config = rackConfigurations[rackId];
            
            if (!config) return;
            
            // Update UI
            document.getElementById('rackTitle').textContent = config.name;
            document.getElementById('rackDetails').textContent = config.details;
            
            // Clear current rack
            clearRackSilent();
            
            // Load new rack configuration
            loadRackConfiguration(config);
        }
        
        // Override rack configuration for Server Room
        function initializeServerRoomRack() {
            // Server Room specific configuration
            rackConfigurations = {
                'SR': {
                    name: 'Server Room Core Infrastructure - Main Data Center',
                    details: 'Cisco Catalyst 9300 Core Switch ‚Ä¢ 24-Port Fiber Distribution LIU ‚Ä¢ Dell PowerEdge Servers ‚Ä¢ Redundant UPS Systems',
                    location: 'Main Data Center',
                    devices: {
                        // LIU Panel (Unit 42) - 24 port distribution hub
                        42: {
                            deviceId: 'LIU-SR-002',
                            deviceType: 'patch-panel',
                            portCount: 24,
                            ports: {},
                            name: 'Server Room LIU 2 (24-Port)',
                            details: '24-Port Fiber Distribution Hub - Connects to all remote sites'
                        },
                        
                        // Core Switch (Unit 40)
                        40: {
                            deviceId: 'SW-SR-001',
                            deviceType: 'switch',
                            portCount: 48,
                            ports: {},
                            name: 'Cisco Catalyst 9300 Core Switch',
                            details: 'Core distribution switch with 48 ports'
                        },
                        
                        // Application Server (Unit 38)
                        38: {
                            deviceId: 'SRV-SR-001',
                            deviceType: 'server',
                            portCount: 4,
                            ports: {},
                            name: 'Application Server 1',
                            details: 'Dell PowerEdge R740 - Primary application server'
                        },
                        
                        // Database Server (Unit 36)
                        36: {
                            deviceId: 'SRV-SR-002',
                            deviceType: 'server',
                            portCount: 4,
                            ports: {},
                            name: 'Database Server',
                            details: 'Dell PowerEdge R740 - Primary database server'
                        },
                        
                        // File Server (Unit 34)
                        34: {
                            deviceId: 'SRV-SR-003',
                            deviceType: 'server',
                            portCount: 4,
                            ports: {},
                            name: 'File Server',
                            details: 'Dell PowerEdge R640 - File and backup server'
                        },
                        
                        // Primary UPS (Unit 3)
                        3: {
                            deviceId: 'UPS-SR-001',
                            deviceType: 'ups',
                            portCount: 0,
                            ports: {},
                            name: 'APC Smart-UPS 3000VA Primary',
                            details: 'Primary UPS for critical infrastructure'
                        },
                        
                        // Secondary UPS (Unit 2)
                        2: {
                            deviceId: 'UPS-SR-002',
                            deviceType: 'ups',
                            portCount: 0,
                            ports: {},
                            name: 'APC Smart-UPS 3000VA Secondary',
                            details: 'Secondary UPS for redundancy'
                        }
                    },
                    connections: [],
                    portMappings: {
                        // LIU distribution ports
                        'LIU-SR-002-port-13': {
                            uplink: true,
                            mapping: 'Distribution to Gate 2C Port 1',
                            endDevice: 'Gate 2C LIU'
                        },
                        'LIU-SR-002-port-14': {
                            uplink: true,
                            mapping: 'Distribution to Gate 2C Port 2',
                            endDevice: 'Gate 2C LIU'
                        },
                        'LIU-SR-002-port-15': {
                            uplink: true,
                            mapping: 'Distribution to Gate 2C Port 3',
                            endDevice: 'Gate 2C LIU'
                        },
                        'LIU-SR-002-port-16': {
                            uplink: true,
                            mapping: 'Distribution to Gate 2C Port 4',
                            endDevice: 'Gate 2C LIU'
                        },
                        'LIU-SR-002-port-17': {
                            uplink: true,
                            mapping: 'Direct to Gate 2B',
                            endDevice: 'Gate 2B Switch'
                        },
                        'LIU-SR-002-port-18': {
                            uplink: true,
                            mapping: 'Direct to Gate 2B',
                            endDevice: 'Gate 2B Switch'
                        }
                    }
                }
            };
            
            // Set current rack to Server Room
            currentRackId = 'SR';
            
            // Update UI immediately
            document.getElementById('rackTitle').textContent = rackConfigurations['SR'].name;
            document.getElementById('rackDetails').textContent = rackConfigurations['SR'].details;
            
            // Load Server Room configuration
            switchRack('SR');
        }
        
        // Initialize with Server Room specific configuration
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Server Room rack BEFORE calling the main initialization
            initializeServerRoomRack();
            
            // Override the main initialization to prevent Gate 2C loading
            // Don't call initializeRack() as it loads Gate 2C by default
            
            console.log('üè¢ Server Room Rack Manager initialized with navigation support');
        });
    </script>

    <!-- Port Information Edit Modal -->
    <div class="port-edit-modal" id="portEditModal">
        <div class="port-edit-content">
            <div class="port-edit-header">
                <h3 id="portEditTitle">Edit Port Information</h3>
                <button class="close-modal" onclick="closePortEditModal()">‚úï</button>
            </div>
            
            <div class="port-edit-body">
                <div class="form-group">
                    <label>Port Number</label>
                    <input type="text" id="editPortNumber" readonly class="form-control-readonly">
                </div>
                
                <div class="form-group">
                    <label>Device Type</label>
                    <input type="text" id="editDeviceType" readonly class="form-control-readonly">
                </div>
                
                <div class="form-group">
                    <label>Port Status</label>
                    <select id="editPortStatus" class="form-control">
                        <option value="free">Free</option>
                        <option value="active">Active</option>
                        <option value="uplink">Uplink</option>
                        <option value="disabled">Disabled</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Connected Device</label>
                    <input type="text" id="editConnectedDevice" class="form-control" placeholder="e.g., Gate 2C WiFi, CCTV Camera">
                </div>
                
                <div class="form-group">
                    <label>Device IP Address</label>
                    <input type="text" id="editDeviceIP" class="form-control" placeholder="e.g., 192.168.30.25">
                </div>
                
                <div class="form-group">
                    <label>VLAN ID</label>
                    <input type="text" id="editVLAN" class="form-control" placeholder="e.g., VLAN 10">
                </div>
                
                <div class="form-group">
                    <label>Connected To (Port/Panel)</label>
                    <input type="text" id="editConnectedTo" class="form-control" placeholder="e.g., PP-1 Port 6, Switch Port 23">
                </div>
                
                <div class="form-group">
                    <label>Cable ID</label>
                    <input type="text" id="editCableID" class="form-control" placeholder="e.g., CAT6-G2C-001">
                </div>
                
                <div class="form-group">
                    <label>Location / Room</label>
                    <input type="text" id="editLocation" class="form-control" placeholder="e.g., Security Room, Gate 2C">
                </div>
                
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="editNotes" class="form-control" rows="3" placeholder="Additional notes about this port connection..."></textarea>
                </div>
            </div>
            
            <div class="port-edit-footer">
                <button class="btn btn-secondary" onclick="closePortEditModal()">Cancel</button>
                <button class="btn btn-danger" onclick="clearPortInfo()">Clear Info</button>
                <button class="btn btn-primary" onclick="savePortInfo()">Save Changes</button>
            </div>
        </div>
    </div>
</body>
</html>